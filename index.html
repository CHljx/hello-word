<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script>
      var defaultFontSize = 0;
      function getDefaultFS() {
          var d = window.document.createElement('div');
          d.style.width = '1rem';
          d.style.display = "none";
          var head = window.document.getElementsByTagName('head')[0];
          head.appendChild(d);
          defaultFontSize = parseFloat(window.getComputedStyle(d, null).getPropertyValue('width'));
          d.remove();
      }
      function adapt(designWidth, rem2px) {
          if(!navigator.userAgent.match(/(iphone|ipad|android)/gi)){
              document.documentElement.style.fontSize="50px";
              document.documentElement.style.background = "#000";
              return;
          }
          if (window.orientation == 0 || window.orientation == 180) {
              document.documentElement.classList.remove("hori");
          } else {
              document.documentElement.classList.add("hori");
          }
          var head = window.document.getElementsByTagName('head')[0];
          document.documentElement.style.fontSize = window.innerWidth / designWidth * rem2px / defaultFontSize * 100 + '%';
          var st = document.createElement('style');
          var portrait = "@media screen and (min-width: " + window.innerWidth + "px) {html{font-size:" + ((window.innerWidth / (designWidth / rem2px) / defaultFontSize) * 100) + "%;}}";
          var landscape = "@media screen and (min-width: " + window.innerHeight + "px) {html{font-size:" + ((window.innerHeight / (designWidth / rem2px) / defaultFontSize) * 100) + "%;}}"
          st.innerHTML = portrait + landscape;
          head.appendChild(st);
      };
      getDefaultFS();
      adapt(750, 100);
      window.addEventListener("resize", function () {
          adapt(750, 100);
      })
    </script>
    <style>
      .hori .toolbar-hb-tb {
          font-size: 13px;
      }
      .warn{
          background: #ffcece;
      }
      
    </style>
  <link href="static/css/entry.min.css" rel="stylesheet"></head>
  <body>
    <div id="app" style="opacity:0" :class="appClass">
      <load></load>
      <div id="app-body">
        <app-header :list="list.headers" v-model="target.headerIndex">
          <div class="header-toolbar flex-row" v-show="target.headerIndex==0"><span class="flex-item" @click="target.realTab=item.value" v-for="item in list.realTabs" v-html="item.name" :class="{active:target.realTab==item.value}"></span></div>
        </app-header>
        <div class="body">
          <mask-box class="body-aside" v-model="flag.showAside">
            <div class="body-aside-box">
              <div class="badge-box">
                <p class="title">渠道大类：</p>
                <div><span class="badge" v-html="classfiyCH" @click="changeStatus(&quot;channel&quot;,true)"></span></div>
              </div>
              <div class="badge-box">
                <p class="title">渠道：</p>
                <div><span class="badge" v-for="item in channels" v-html="item.text" @click="changeStatus(&quot;channel&quot;,true)"></span></div>
              </div>
              <div class="badge-box">
                <p class="title">子渠道：</p>
                <div><span class="badge" v-for="item in subChannels" v-html="item.text" @click="changeStatus(&quot;channel&quot;,true)"></span></div>
              </div>
              <div class="badge-box">
                <p class="title">游戏：</p>
                <div><span class="badge" v-for="item in games" v-html="item.text" @click="changeStatus(&quot;game&quot;,true)"></span></div>
              </div>
              <div class="badge-box">
                <p class="title">子游戏：</p>
                <div><span class="badge" v-for="item in subGames" v-html="item.text" @click="changeStatus(&quot;game&quot;,true)"></span></div>
              </div>
              <div class="badge-box" v-show="param.search.site">
                <p class="title">子站：</p>
                <div><span class="badge" v-html="param.search.site" @click="changeStatus(&quot;site&quot;,true)"></span></div>
              </div>
              <div class="input-group">
                <input placeholder="请输入配置名" v-model="param.local.name">
                <button class="button" @click="saveLocal">保存</button>
              </div>
              <div class="badge-box" v-show="list.locals.length&gt;0" style="border-bottom:0;">
                <div>
                  <div class="badge full-w" v-for="(item,index) in list.locals" v-if="item" @click="resetParam(item.setting)"><span v-html="item.name"></span><span class="iconfont icon-close-circle fl-right" @click.stop="removeLocal(index)"></span></div>
                </div>
              </div>
            </div>
          </mask-box>
          <div class="body-header"><span class="iconfont icon-param" @click="flag.showAside=true">条件项</span></div>
          <div class="body-content" ref="bodyContent">
            <div class="full-h" v-show="flag.isQuery" style="position:relative;padding-top:.5rem;">
              <div class="toolbar-hb-tb" style="min-height:.5rem;line-height:.5rem;position:absolute;left:0;right:0;top:0;" v-show="target.headerIndex==0">
                <p v-show="target.realTab=='popup'">环比：<span v-html="ratePost(table.popup.hb)" :class="rateClass(table.popup.hb)"></span> 同比：<span v-html="ratePost(table.popup.tb)" :class="rateClass(table.popup.tb)"></span></p>
                <p v-show="target.realTab=='view'">环比：<span v-html="ratePost(table.view.hb)" :class="rateClass(table.view.hb)"></span> 同比：<span v-html="ratePost(table.view.tb)" :class="rateClass(table.view.tb)"></span></p>
                <p v-show="target.realTab=='reg'">环比：<span v-html="ratePost(table.reg.hb)" :class="rateClass(table.reg.hb)"></span> 同比：<span v-html="ratePost(table.reg.tb)" :class="rateClass(table.reg.tb)"></span></p>
              </div>
              <div class="full-h" ref="content">
                <div v-show="target.headerIndex==1">
                  <ts-table v-load="loadStatus.detail" :headers="table.detail.header" :rows="detailRows" fixed="1" :height="table.height?(table.height+table.headerToolbarHeight):0" :header-list="detailHeaderRows"></ts-table>
                </div>
                <div class="full-h" v-show="target.headerIndex==0">
                  <div v-show="target.realTab=='popup'">
                    <ts-table v-load="loadStatus.popup" :headers="table.popup.header" :rows="popupRows" fixed="1" :height="table.height" :header-list="popupHeaderRows"></ts-table>
                  </div>
                  <div v-show="target.realTab=='view'">
                    <ts-table v-load="loadStatus.view" :headers="table.view.header" :rows="viewRows" fixed="1" :height="table.height" :header-list="viewHeaderRows"></ts-table>
                  </div>
                  <div v-show="target.realTab=='reg'">
                    <ts-table v-load="loadStatus.reg" :headers="table.reg.header" :rows="regRows" fixed="1" :height="table.height" :header-list="regHeaderRows"></ts-table>
                  </div>
                  <div class="full-h" v-load="loadStatus.real" v-show="target.realTab=='real'" style="min-height:3rem;overflow:auto;">
                    <div class="flex-row frame-box" v-show="list.dashboards.length">
                      <div class="flex-item frame-item" v-for="(item,index) in list.dashboards" @click="target.dashboard=index" :class="{active:target.dashboard==index}">
                        <p class="title" v-html="item.name"></p>
                        <p v-html="item.sum"></p>
                        <p>环比：<span v-html="ratePost(item.hb)" :class="rateClass(item.hb)"></span></p>
                        <p>同比：<span v-html="ratePost(item.tb)" :class="rateClass(item.tb)"></span></p>
                      </div>
                    </div>
                    <div class="mb">
                      <chart type="line" chart-extend :chart-options="dashboardChart" :style="{height:table.height/2+'px'}"></chart>
                    </div>
                    <div class="mb" v-for="item in list.sumTables">
                      <h5 v-html="item.name"></h5>
                      <ts-table class="mb" :headers="item.headers" :rows="item.rows" fixed="1"></ts-table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="empty" v-show="!flag.isQuery"><i class="iconfont icon-empty"></i> 请选择好渠道，游戏，子站查询</div>
          </div>
          <div class="body-footer">
            <div>
              <button class="button" @click="actQuery">查询</button>
            </div>
          </div>
        </div>
        <calendar v-model="status.calendar" @change="setDate" range :validate-fn="validateDate"></calendar>
        <mask-box v-model="status.date">
          <div class="toolbar-date">
            <ul>
              <li class="date-item" @click="chooseDate(0)">当天</li>
              <li class="date-item" @click="chooseDate(-2)">最近3天</li>
              <li class="date-item" @click="chooseDate(-7)">最近8天</li>
              <li class="date-item" @click="changeStatus('calendar',true)">自定义</li>
            </ul>
          </div>
        </mask-box>
        <modal class="setting-modal" title="请选择渠道" v-model="status.channel" @show="cloneParam('modal','search','channel');cloneParam('modal','search','union_category')" @ok="cloneParam('search','modal','channel');cloneParam('search','modal','union_category')">
          <div class="flex-row flex-wrap">
            <div class="setting-item" v-for="item in list.classfiy"><span v-html="item.name" :class="{'clr-active':item.value==param.modal.union_category}" @click="param.modal.union_category=item.value"></span></div>
          </div>
          <search-plus-list child-field="children" v-model="param.modal.channel" :rows="list.classfiyChannels" sub-url="/index.php?c=gnweb&amp;a=union_mapping_list"></search-plus-list>
        </modal>
        <modal class="setting-modal" title="请选择游戏" v-model="status.game" @show="cloneParam('modal','search','game')" @ok="cloneParam('search','modal','game')">
          <search-plus-list placeholder="请输入游戏名" no-child url="/index.php?c=gnweb&amp;a=game_list" sub-url="/index.php?c=gnweb&amp;a=c_game_list" sub-field="game_id" v-model="param.modal.game"></search-plus-list>
        </modal>
        <modal title="请选择子站" v-model="status.site" @show="cloneParam('modal','search','site')" @ok="cloneParam('search','modal','site')">
          <div class="search-box">
            <div class="search-input-box">
              <input class="search-input" placeholder="请输入子站名" v-model="param.modal.site">
            </div>
            <div class="search-list" v-show="list.uids.length">
              <div class="list-item">最近常用</div>
              <div class="list-item" v-for="item in list.uids" v-html="item" @click="param.search.site=item;status.site=false;"></div>
            </div>
          </div>
        </modal>
        <modal v-model="status.setting" @show="cloneParam('modal','setting','sums'),cloneParam('modal','setting','columns')" @ok="doSetColumns">
          <div class="font-strong">实时数据</div>
          <div class="flex-row flex-wrap">
            <div class="setting-item" v-for="item in list.sumTabs"><span v-html="item.label" :class="{'clr-active':param.modal.sums[item.key]}" @click="param.modal.sums[item.key]=+!param.modal.sums[item.key]"></span></div>
          </div>
          <div>
            <div class="font-strong">明细数据</div>
            <div class="setting-group">维度列</div>
            <div class="flex-row flex-wrap">
              <div class="setting-item" v-for="item in list.columns.slice(1,6)"><span v-html="item.label" :class="{'clr-active':param.modal.columns[item.key]}" @click="param.modal.columns[item.key]=+!param.modal.columns[item.key]"></span></div>
            </div>
            <div class="setting-group"> 数据列</div>
            <div class="flex-row flex-wrap">
              <div class="setting-item" v-for="item in list.columns.slice(6)"><span v-html="item.label" :class="{'clr-active':param.modal.columns[item.key]}" @click="param.modal.columns[item.key]=+!param.modal.columns[item.key]"></span></div>
            </div>
          </div>
        </modal>
        <app-footer :list="list.footers"></app-footer>
      </div>
    </div>
    <script>
      var requirejs = {
          baseUrl: "./static/js/app/",
          paths:{
              url:"./report/pc.config"
          }
      };
      var APP = ["xzl/entry"]
    </script>
    <script src="./static/js/lib/require.js"></script>
  <script type="text/javascript" src="static/js/entry.min.js"></script></body>
</html>